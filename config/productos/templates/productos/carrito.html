{% extends 'core/base.html' %}
{% load formatos %} {% block title %}Carrito de compras - Ecofor Market{% endblock %}

{% block content %}
<div class="container">
  <h1>Carrito de compras</h1>

  {% if carrito.cart %}
    <table class="cart-table">
      <tr>
        <th>Producto</th>
        <th style="text-align: center;">Cantidad</th> <th>Precio unitario</th>
        <th>Subtotal</th>
        <th></th>
      </tr>
      {% for item in carrito %}
        <tr>
          <td>{{ item.producto.nombre }}</td>
          
          <td style="text-align: center;">
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                
                <a href="{% url 'restar_del_carrito' item.producto.id %}" 
                   style="background: #ddd; color: black; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-weight: bold;">
                   -
                </a>

                <span style="font-weight: bold; font-size: 1.1em;">{{ item.cantidad }}</span>

                <form action="{% url 'agregar_al_carrito' item.producto.id %}" method="POST" style="margin:0;">
                    {% csrf_token %}
                    <input type="hidden" name="cantidad" value="1">
                    <button type="submit" 
                            style="background: #0B3B2E; color: white; width: 25px; height: 25px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                        +
                    </button>
                </form>

            </div>
          </td>
          <td>{{ item.precio|clp }}</td>
          <td>{{ item.subtotal|clp }}</td>
          <td>
            <a href="{% url 'eliminar_del_carrito' item.producto.id %}" class="btn btn-link" style="color: #dc3545;">Quitar</a>
          </td>
        </tr>
      {% endfor %}
    </table>

    <div class="cart-summary">
      Total: {{ carrito.total|clp }}
    </div>

    <div style="margin-top:1rem; text-align:right;">
      <a href="{% url 'catalogo_productos' %}" class="btn btn-secondary">Seguir comprando</a>
      <a href="{% url 'vaciar_carrito' %}" class="btn btn-secondary">Vaciar carrito</a>
      <a href="{% url 'finalizar_compra' %}" class="btn btn-primary">Finalizar compra (simulada)</a>
      {% if user.es_empresa %}
        <a href="{% url 'generar_factura' %}" class="btn btn-primary">Generar generar_factura</a>
        <a href="{% url 'crear_pedido_cotizacion' %}" class="btn btn-secondary">
            Crear pedido para cotización
        </a>
        {% if pedido %}
            <a href="{% url 'solicitar_cotizacion' pedido=pedido.id %}" class="btn btn-primary">
                Solicitar cotización
            </a>
        {% endif %}

      {% endif %}
    </div>
  {% else %}
    <p>Tu carrito está vacío.</p>
    <a href="{% url 'catalogo_productos' %}" class="btn btn-primary">Ir al catálogo</a>
  {% endif %}
</div>
{% endblock %}